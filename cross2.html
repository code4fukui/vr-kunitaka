<!DOCTYPE html>
<html>
  <head>
    <title>S字</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://rawgit.com/fernandojsg/aframe-teleport-controls/master/dist/aframe-teleport-controls.min.js"></script>
    <!-- <script type="module" src="./drone-controls-mode2.js"></script>-->
    <script
      type="module"
      src="https://code4fukui.github.io/glb-viewer/mc-controls.js"
    ></script>
  </head>

  <body>
    <a-scene
      id="scene"
      background="color: #333"
      renderer="colorManagement: true"
    >
      <a-assets timeout="10000">
        <a-asset-item
          id="road"
          src="./kunitaka-cross2-lidar.glb"
        ></a-asset-item>
        <a-asset-item id="car" src="./car-edit.glb"></a-asset-item>
      </a-assets>
      <a-entity
        gltf-model="#road"
        position="0 0 0"
        scale="1 1 1"
        rotation="0 0 0"
      ></a-entity>
      <a-entity
        id="mcar1"
        gltf-model="#car"
        position="25 .5 10"
        scale="1 1 1"
        rotation="0 42 0"
      ></a-entity>
      <a-entity
        id="mcar2"
        gltf-model="#car"
        position="-25 .5 -14"
        scale="1 1 1"
        rotation="0 240 0"
      ></a-entity>
      <a-entity light="type: ambient; color: #FFF"></a-entity>
      <!-- <a-sphere id="sphere" color="#f22"></a-sphere> --><a-entity
        id="cameraRig"
        position="40 -.5 10"
        rotation="0 45 0"
        ><!-- 最初の場所と視点はここ -->
        <a-entity
          id="head"
          camera
          position="0 1.7 0"
          mc-controls
          look-controls
          x-drone-controls-mode2
        ></a-entity>
        <a-entity
          oculus-touch-controls="hand:left"
          teleport-controls="button:trigger; collisionEntities:.collidable; cameraRig:#cameraRig; teleportOrigin:#head;"
        ></a-entity>
        <a-entity
          oculus-touch-controls="hand:right"
          teleport-controls="button:trigger; collisionEntities:.collidable; cameraRig:#cameraRig; teleportOrigin:#head;"
        ></a-entity>
        <!--<a-entity id="leftHand" hand-tracking-controls="hand: left;"></a-entity><a-entity id="rightHand" hand-tracking-controls="hand: right;"></a-entity>-->
      </a-entity>
    </a-scene>

    <script type="module">
      import { sleep } from "https://js.sabae.cc/sleep.js";

      const pos1 = { x: 25, y: 0.5, z: 10 }; // 車の初期位置
      const rot1 = { x: 0, y: 42, z: 0 }; // 車の初期回転
      const pos2 = { x: -25, y: 0.5, z: -14 }; // 車の初期位置
      const rot2 = { x: 0, y: 240, z: 0 }; // 車の初期回転
      for (;;) {
        mcar1.setAttribute("position", pos1);
        mcar1.setAttribute("rotation", rot1);
        mcar2.setAttribute("position", pos2);
        mcar2.setAttribute("rotation", rot2);
        rot1.y += 0.07;
        pos1.x -= 0.05;
        pos1.z -= 0.07;
        //rot2.y -= .5;
        //pos2.x -= .5;
        if (pos1.x < 22) {
          pos1.x = 22;
          pos1.z = 6;
          rot1.y = 50;
          console.log(pos1);
          for (;;) {
            mcar1.setAttribute("position", pos1);
            mcar1.setAttribute("rotation", rot1);
            mcar2.setAttribute("position", pos2);
            mcar2.setAttribute("rotation", rot2);
            pos1.x -= 0.1;
            pos1.z -= 0.1;
            rot1.y += 0.01;
            if (pos1.x < 21.5) {
              pos1.x = 21.5;
              pos1.z = 5.5;
              rot1.y = 50;
              for (;;) {
                mcar1.setAttribute("position", pos1);
                mcar1.setAttribute("rotation", rot1);
                mcar2.setAttribute("position", pos2);
                mcar2.setAttribute("rotation", rot2);
                pos1.x -= 0.1;
                pos1.z -= 0.1;
                if (pos1.x < 20.5 && pos1.z < 5) {
                  pos1.x = 20.5;
                  pos1.z = 5;
                  rot1.y = 50;
                  for (;;) {
                    mcar1.setAttribute("position", pos1);
                    mcar1.setAttribute("rotation", rot1);
                    mcar2.setAttribute("position", pos2);
                    mcar2.setAttribute("rotation", rot2);
                    pos1.x -= 0.15;
                    pos1.x -= 0.75;
                    rot1.y += 0.2;
                    if (pos1.x < 19) {
                      pos1.x = 19;
                      pos1.z = 4;
                      rot1.y = 50;
                      console.log(pos1);
                      for (;;) {
                        mcar1.setAttribute("position", pos1);
                        mcar1.setAttribute("rotation", rot1);
                        mcar2.setAttribute("position", pos2);
                        mcar2.setAttribute("rotation", rot2);
                        pos1.z -= 0.05;
                        rot1.y += 0.2;
                        if (pos1.z < 3.5) {
                          pos1.x = 19;
                          pos1.z = 3.5;
                          rot1.y = 60;
                          for (;;) {
                            mcar1.setAttribute("position", pos1);
                            mcar1.setAttribute("rotation", rot1);
                            mcar2.setAttribute("position", pos2);
                            mcar2.setAttribute("rotation", rot2);
                            pos1.z -= 0.05;
                            rot1.y += 0.2;
                            if (pos1.z < 3.3) {
                              pos1.x = 20;
                              pos1.z = 3.3;
                              rot1.y = 70;
                              for (;;) {
                                mcar1.setAttribute("position", pos1);
                                mcar1.setAttribute("rotation", rot1);
                                mcar2.setAttribute("position", pos2);
                                mcar2.setAttribute("rotation", rot2);
                                pos1.x -= 0.05;
                                pos1.z -= 0.05;
                                rot1.y += 0.2;
                                if (pos1.x < 10) {
                                  pos1.x = 10;
                                  pos1.z = 3;
                                  rot1.y = 70;
                                }
                                await sleep(1000 / 60);
                              }
                            }
                            await sleep(1000 / 60);
                          }
                        }
                        await sleep(1000 / 60);
                      }
                    }
                    await sleep(1000 / 60);
                  }
                }
                await sleep(1000 / 60);
              }
            }
            await sleep(1000 / 60);
          }
        }
        if (pos2.x < 20) {
          pos2.x = -25;
        }
        await sleep(1000 / 60);
      }
    </script>
  </body>
</html>
